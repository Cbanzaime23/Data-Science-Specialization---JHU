---
title: "Reproducible Research - Final Project"
author: "Christian Ibanez"
date: "`r Sys.Date()`"
output: html_document
---
### Synopsis : 
#### The overall goal of this assignment is to explore the National Emissions Inventory database to answer the questions
#### "Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?" and "Across the United States, which types of events have the greatest economic consequences?"

---

### Executive Summary: 
#### Tornado is the top in terms of Fatality and Injuiry count and in terms of Property Damage compare to all other Store related events but Hail storm is the no. 1 in terms of Crop/Agricultural Damage

---

### Data Processing:

#### Import the Libraries

```{r, echo = TRUE,message = FALSE,warning=FALSE}
library(dplyr)
library(ggplot2)
library(utils)
```

#### Import the Datasets

```{r, echo = TRUE,message = FALSE,warning=FALSE}
# Get the directory where the R script is located
script_directory <- dirname(rstudioapi::getSourceEditorContext()$path)

# Set the working directory to the script's directory
setwd(script_directory)

## This first line will likely take a few seconds. Be patient!
# Path to your compressed file
file_path <- "./Data/repdata_data_StormData.csv.bz2"

# Open the bz2 file connection
bzfile_conn <- bzfile(file_path, "rt")

# Read the contents of the file using read.csv
repdata_data_StormData <- read.csv(bzfile_conn)
```
#### Let have a look the dataset

```{r, include=TRUE}
head(repdata_data_StormData)

```


```{r, include=TRUE}

# Create a groupby to aggregate the values of total_Fatality, total_Injury, total_PropertyDamage, total_CropDamage
DF <- repdata_data_StormData %>% 
        group_by(EVTYPE) %>% 
            summarise(total_Fatality = sum(FATALITIES),
                      total_Injury = sum(INJURIES),
                      total_PropertyDamage = sum(PROPDMG),
                      total_CropDamage = sum(CROPDMG))

DF %>% arrange(desc(total_Fatality)) %>% slice(1:5) #Sort by 'total_Fatality'
```


### Results:

#### 1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?
```{r, include=TRUE}

DF1 <- DF[order(DF$total_Fatality, decreasing = TRUE), ] %>% 
            arrange(desc(total_Fatality)) %>% 
                slice(1:20) #Select only the Top 20

bar_chart1 <- ggplot(DF1, aes(x = reorder(EVTYPE, -total_Fatality), y = total_Fatality, fill = EVTYPE)) +
          geom_bar(stat = "identity") +
        scale_fill_manual(values = c( "gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","blue","gray","gray","gray")) +  # Set colors
        theme_minimal() +
          labs(title = "TORNADO is the top 1 Fatality cause . . .", x = "Event Type(EVTYPE)", y = "Total Fatality")+
        theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5)) + 
        guides(fill = FALSE)  # Remove legends for fill and x-axis
print(bar_chart1)
```
```{r, include=TRUE}
DF2 <- DF[order(DF$total_Injury, decreasing = TRUE), ] %>% 
            arrange(desc(total_Injury)) %>% 
                slice(1:20) #Select only the Top 20

bar_chart2 <- ggplot(DF2, aes(x = reorder(EVTYPE, -total_Injury), y = total_Injury, fill = EVTYPE)) +
          geom_bar(stat = "identity") +
        scale_fill_manual(values = c( "gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","blue","gray","gray","gray","gray","gray")) +  # Set colors
        theme_minimal() +
          labs(title = ". . .And also the top 1 in terms of Injury cause by Event Type", x = "Event Type(EVTYPE)", y = "Total Injuries")+
        theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
        guides(fill = FALSE)  # Remove legends for fill and x-axis

print(bar_chart2)
```


#### 2. Across the United States, which types of events have the greatest economic consequences?

```{r, include=TRUE}
DF3 <- DF[order(DF$total_PropertyDamage, decreasing = TRUE), ] %>% 
            arrange(desc(total_PropertyDamage)) %>% 
                slice(1:20) #Select only the Top 20

bar_chart3 <- ggplot(DF3, aes(x = reorder(EVTYPE, -total_PropertyDamage), y = total_PropertyDamage, fill = EVTYPE)) +
          geom_bar(stat = "identity") +
        scale_fill_manual(values = c( "gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","blue","gray","gray","gray","gray","gray","gray","gray")) +  # Set colors
        theme_minimal() +
          labs(title = "Tornado also has the greatest economic consequence in terms of \n property damage...", x = "Event Type(EVTYPE)", y = "Property Damage")+
        theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
        guides(fill = FALSE)  # Remove legends for fill and x-axis

print(bar_chart3)
```


```{r, include=TRUE}
DF4 <- DF[order(DF$total_CropDamage, decreasing = TRUE), ] %>% 
            arrange(desc(total_PropertyDamage)) %>% 
                slice(1:20) #Select only the Top 20

bar_chart3 <- ggplot(DF4, aes(x = reorder(EVTYPE, -total_CropDamage), y = total_CropDamage, fill = EVTYPE)) +
          geom_bar(stat = "identity") +
        scale_fill_manual(values = c( "gray","gray","gray","blue","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray")) +  # Set colors
        theme_minimal() +
          labs(title = "... But Hail has the most economic consequence in terms of \n Agricutural/Crop Damage", x = "Event Type(EVTYPE)", y = "Crop Damage")+
        theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))+
        guides(fill = FALSE)  # Remove legends for fill and x-axis

print(bar_chart3)
```